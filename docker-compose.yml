services:
  miniapp:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: iftar-miniapp
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.iftar-miniapp.rule=Host(`iftar.adntgv.com`)"
      - "traefik.http.routers.iftar-miniapp.entrypoints=http"
      - "traefik.http.services.iftar-miniapp.loadbalancer.server.port=80"
    networks:
      - coolify
      - default
    restart: unless-stopped

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: iftar-api
    environment:
      - DATABASE_URL=postgres://iftar_user:iftar_secure_pass_2026@io4gs04gskogggg40g8s0s00:5432/iftar_db
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.iftar-api.rule=Host(`iftar-api.adntgv.com`)"
      - "traefik.http.routers.iftar-api.entrypoints=http"
      - "traefik.http.services.iftar-api.loadbalancer.server.port=3002"
    networks:
      - coolify
      - default
    restart: unless-stopped

  bot:
    build:
      context: ./bot
      dockerfile: Dockerfile
    container_name: iftar-bot
    environment:
      - DATABASE_URL=postgres://iftar_user:iftar_secure_pass_2026@io4gs04gskogggg40g8s0s00:5432/iftar_db
      - BOT_TOKEN=8566435220:AAGuzu09JYKhOxQgp1oEVGBFh5mcCXpBjCw
      - MINI_APP_URL=https://iftar.adntgv.com
      - API_URL=http://api:3002
    networks:
      - coolify
      - default
    restart: unless-stopped

  og-api:
    build:
      context: ./og-api
      dockerfile: Dockerfile
    container_name: iftar-og-api
    environment:
      - API_URL=http://api:3002
      - BOT_USERNAME=iftar_coordinator_bot
    networks:
      - default
    restart: unless-stopped

networks:
  coolify:
    external: true
